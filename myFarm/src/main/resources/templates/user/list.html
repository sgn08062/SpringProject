<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ëª©ë¡ - ë†ì¥ì§ì†¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 8% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            box-sizing: border-box;
            border-radius: 4px;
        }
        .btn-wrapper {
            display: flex;
            gap: 5px;
        }
        .btn-wrapper .btn {
            flex-grow: 1;
            text-align: center;
        }
        .btn.buy {
            background-color: #ffc107;
        }
        .btn.cart {
            background-color: #28a745;
        }
        .cart-form-inline {
            flex-grow: 1;
            display: flex;
        }
        .cart-form-inline .btn.cart {
            width: 100%;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            color: white;
        }
        #loginModal .modal-content button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 100%;
            border-radius: 4px;
        }
        #detailModal .modal-content button {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            width: auto;
            margin-top: 10px;
        }
    </style>

</head>
<body class="light">

<header>
    <div class="header-container">
        <div class="logo">
            <img src="#" alt="ë†ì¥ì§ì†¡ ë¡œê³ ">
            <span>ë†ì¥ì§ì†¡</span>
        </div>
        <div class="header-top">
            <a th:href="@{/product/list}">ìƒí’ˆ</a>
            <a th:href="@{/user/orders}">ë§ˆì´í˜ì´ì§€</a>

            <a th:href="@{/user/cart}">ì¥ë°”êµ¬ë‹ˆ</a>

            <th:block th:if="${!isLoggedIn}">
                <a href="#" id="loginModalBtn">ë¡œê·¸ì¸</a>
                <a href="#">íšŒì›ê°€ì…</a>
            </th:block>

            <a th:href="@{/logout}" th:if="${isLoggedIn}">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</header>

<div class="main-banner">
    <h1>ì‹ ì„ í•œ ë†ì‚°ë¬¼ ì§ê±°ë˜</h1>
    <p>ë†ë¶€ê°€ ì§ì ‘ í‚¤ìš´ ìœ ê¸°ë† ë†ì‚°ë¬¼ì„ ë§Œë‚˜ë³´ì„¸ìš”</p>
</div>

<div class="search-container">
    <form th:action="@{/product/list}" method="get" class="search-form">
        <input type="text" name="searchKeyword" placeholder="ğŸ” ìƒí’ˆ ê²€ìƒ‰..." th:value="${searchKeyword}">
        <select name="sortField">
            <option value="regDate" th:selected="${sortField == 'regDate'}">ì „ì²´</option>
            <option value="priceAsc" th:selected="${sortField == 'priceAsc'}">ê°€ê²© ë‚®ì€ìˆœ</option>
        </select>
    </form>
</div>

<div id="productList" th:if="${itemList != null}">
    <div class="crop-item" th:each="item : ${itemList}">

        <a th:href="@{/product/detail(itemId=${item.itemId})}" class="item-image-link">
            <div class="item-image">
                <th:block th:switch="${item.itemId}">
                    <img th:case="1" src="https://images.unsplash.com/photo-1745791562822-7ac21012bbb2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                    <img th:case="2" src="https://images.unsplash.com/photo-1657411658279-e32af8636eb1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                    <img th:case="3" src="https://images.unsplash.com/photo-1717959159782-98c42b1d4f37?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                    <img th:case="4" src="https://images.unsplash.com/photo-1710528184650-fc75ae862c13?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                    <img th:case="5" src="https://images.unsplash.com/photo-1730202252661-bd76bd26378f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                    <img th:case="*" src="https://images.unsplash.com/photo-1745791562822-7ac21012bbb2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&w=1080" th:alt="${item.itemName} + ' ì´ë¯¸ì§€'">
                </th:block>

                <div th:unless="${item.amount != null and item.amount > 0}" class="sold-out-overlay">SOLD OUT</div>
            </div>
        </a>

        <div class="item-info">
            <div class="flex-item-header">
                <h2 th:text="${item.itemName ?: 'ìƒí’ˆëª…'}">ìƒí’ˆëª…</h2>
                <span class="badge">ìˆ˜í™•ì‹œê¸°</span>
            </div>
            <p class="farmer-name">íŒë§¤ì ì •ë³´</p>
            <p class="price" th:text="|${#numbers.formatDecimal(item.price ?: 0, 0, 'COMMA', 0, 'POINT')}ì› / ê°œ|">ê°€ê²© / ë‹¨ìœ„</p>

            <div class="btn-wrapper">
                <th:block th:if="${item.amount != null and item.amount > 0}">
                    <a th:href="@{/user/checkout(itemId=${item.itemId})}" class="btn buy">ë°”ë¡œ êµ¬ë§¤</a>
                    <form th:action="@{/user/pushCart}" method="post" class="cart-form-inline">
                        <input type="hidden" name="itemId" th:value="${item.itemId}">
                        <input type="hidden" name="amount" value="1">
                        <button type="submit" class="btn cart">ì¥ë°”êµ¬ë‹ˆ</button>
                    </form>
                </th:block>
                <th:block th:unless="${item.amount != null and item.amount > 0}">
                    <span class="btn" style="background-color: var(--muted); color: var(--muted-foreground); cursor: default; width: 100%;">í’ˆì ˆ</span>
                </th:block>
            </div>
        </div>
    </div>
</div>

<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-section">
            <h3>ë†ì¥ì§ì†¡</h3>
            <p>ì‹ ì„ í•œ ë†ì‚°ë¬¼ì„ ë†ì¥ì—ì„œ ì§ì ‘ ì†Œë¹„ìì—ê²Œ ì „ë‹¬í•˜ëŠ” ì§ê±°ë˜ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
        </div>
        <div class="footer-section">
            <h3>ê³ ê°ì„¼í„°</h3>
            <p>ğŸ“ 1588-1234</p>
            <p>âœ‰ï¸ support@farm.com</p>
        </div>
        <div class="footer-section">
            <a th:href="@{/user/orders}">ì£¼ë¬¸ ëª©ë¡</a>
            <a th:href="@{/user/checkout}">ê²°ì œ</a>
            <a href="#">ì´ìš©ì•½ê´€</a>
            <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
        </div>
        <div class="footer-section">
            <h3>íšŒì‚¬ ì •ë³´</h3>
            <p>ğŸ“ ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</p>
            <p>ëŒ€í‘œì´ì‚¬ : ê¹€ë†ë¶€</p>
        </div>
    </div>
</footer>

<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close login-close">&times;</span>
        <h2>ë¡œê·¸ì¸</h2>
        <form action="/login" method="post">
            <label for="username">ì•„ì´ë””</label>
            <input type="text" id="username" name="username" required>

            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">ë¡œê·¸ì¸</button>
        </form>
        <p style="text-align: center; margin-top: 15px;">
            <a href="#" style="color: #007bff;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a> |
            <a href="#" style="color: #007bff;">íšŒì›ê°€ì…</a>
        </p>
    </div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close detail-close">&times;</span>
        <div id="detailContentContainer">
            <p style="text-align: center;">Loading...</p>
        </div>
    </div>
</div>


<script>

    const loginModal = document.getElementById("loginModal");
    const loginBtn = document.getElementById("loginModalBtn");
    const loginClose = document.querySelector("#loginModal .close");

    if(loginBtn) {
        loginBtn.onclick = function(event) {
            event.preventDefault();
            loginModal.style.display = "block";
        }
    }
    if(loginClose) {
        loginClose.onclick = function() {
            loginModal.style.display = "none";
        }
    }

    window.onclick = function(event) {
        if (event.target == loginModal) {
            loginModal.style.display = "none";
        }
    }
</script>

</body>
</html>