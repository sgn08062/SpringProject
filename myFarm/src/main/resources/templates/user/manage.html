<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€ ê´€ë¦¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* íƒ­ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .tab-menu {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab-menu button {
            background-color: transparent;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            color: #555;
            transition: all 0.3s;
        }
        .tab-menu button.active {
            color: #28a745;
            border-bottom: 3px solid #28a745;
            font-weight: 700;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ address.html ìŠ¤íƒ€ì¼ ìœ ì§€) */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); padding-top: 60px; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { padding: 5px 10px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-primary { background-color: #007bff; color: white; }
        .cancelBtn { background-color: #dc3545; color: white; }
    </style>
</head>
<body class="light">

<div class="container" style="padding: 20px;">
    <h1>ë§ˆì´í˜ì´ì§€</h1>

    <div class="tab-menu">
        <button class="tab-button active" data-tab="orderListTab">ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ</button>
        <button class="tab-button" data-tab="addressManageTab">ğŸ“ ë°°ì†¡ì§€ ê´€ë¦¬</button>
    </div>

    <div id="orderListTab" class="tab-content active">
        <h2>ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­ ëª©ë¡</h2>

        <table>
            <thead>
            <tr>
                <th>ì£¼ë¬¸ì¼ì</th>
                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                <th>ìƒí’ˆ ì •ë³´</th>
                <th>ê²°ì œ ê¸ˆì•¡</th>
                <th>ì£¼ë¬¸ ìƒíƒœ</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${orderList}">
                <td th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd')}">2024-10-25</td>
                <td th:text="${order.orderId}">ORD123456</td>
                <td><a th:href="@{/product/order/{id}(id=${order.orderId})}" th:text="${order.representativeItemName}">3ê°œ ìƒí’ˆ</a></td>
                <td th:text="|${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')}ì›|">35,000ì›</td>
                <td th:text="${order.status}">ë°°ì†¡ ì™„ë£Œ</td>
                <td>
                    <button class="btn-primary" th:if="${order.status == 'ì…ê¸ˆ ëŒ€ê¸°'}">ê²°ì œí•˜ê¸°</button>
                    <form th:action="@{/product/order/cancel/{id}(id=${order.orderId})}" method="post" style="display:inline;">
                        <button type="submit" class="cancelBtn" th:if="${order.status == 'ë°°ì†¡ ì¤€ë¹„ì¤‘'}">ì£¼ë¬¸ ì·¨ì†Œ</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <div th:unless="${orderList != null and !orderList.isEmpty()}" style="text-align: center; padding: 30px; color: #888;">
            <p>ì•„ì§ ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <div id="addressManageTab" class="tab-content">
        <h2>ğŸ“ ë°°ì†¡ì§€ ê´€ë¦¬</h2>

        <div th:if="${successMessage}" style="color: green; font-weight: bold; margin-bottom: 15px;" th:text="${successMessage}">ì„±ê³µ ë©”ì‹œì§€</div>

        <button id="openModalBtn" class="btn btn-primary">â• ìƒˆ ë°°ì†¡ì§€ ì¶”ê°€</button>

        <hr>

        <h3>ë“±ë¡ëœ ë°°ì†¡ì§€ ëª©ë¡</h3>
        <table>
            <thead>
            <tr>
                <th>ë³„ì¹­</th>
                <th>ì£¼ì†Œ</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="addr : ${addressList}">
                <td th:text="${addr.addName}">ì§‘</td>
                <td th:text="${addr.address}">ì„œìš¸ì‹œ ê°•ë‚¨êµ¬</td>
                <td>
                    <button type="button" class="editBtn btn-primary"
                            th:data-add-id="${addr.addId}"
                            th:data-add-name="${addr.addName}"
                            th:data-address="${addr.address}">ìˆ˜ì •</button>

                    <form th:action="@{/product/address/delete/{id}(id=${addr.addId})}" method="post" style="display:inline;">
                        <button type="submit" class="deleteBtn cancelBtn">ì‚­ì œ</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="addressModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">ë°°ì†¡ì§€ ì¶”ê°€</h2>

        <form id="addressForm" th:action="@{/product/address}" method="post">
            <input type="hidden" id="addId" name="addId" value="">

            <p>
                <label for="addNameInput">ë°°ì†¡ì§€ ë³„ì¹­:</label>
                <input type="text" id="addNameInput" name="addName" required>
            </p>
            <p>
                <label for="addressFormInput">ì£¼ì†Œ:</label>
                <input type="text" id="addressFormInput" name="address" required>
            </p>

            <button type="submit" id="submitBtn" class="btn btn-primary">ì €ì¥</button>
        </form>
    </div>
</div>

<script>
    // íƒ­ ê¸°ëŠ¥ JavaScript
    function openTab(tabName) {
        // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
        $('.tab-content').removeClass('active');
        // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
        $('.tab-button').removeClass('active');

        // ì„ íƒëœ íƒ­ ì½˜í…ì¸  í‘œì‹œ
        $('#' + tabName).addClass('active');
        // ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
        $(`[data-tab="${tabName}"]`).addClass('active');
    }

    // íƒ­ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $('.tab-button').on('click', function() {
        const tabName = $(this).data('tab');
        openTab(tabName);
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ ê¸°ë³¸ íƒ­ ì„¤ì •
    // URL íŒŒë¼ë¯¸í„°(tab=orderListTab ë˜ëŠ” tab=addressManageTab)ë¥¼ ì½ì–´ì™€ íƒ­ì„ í™œì„±í™”í•©ë‹ˆë‹¤.
    $(document).ready(function() {
        const urlParams = new URLSearchParams(window.location.search);
        const activeTab = urlParams.get('tab') || 'orderListTab'; // 'tab' íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ orderListTabì´ ê¸°ë³¸ê°’
        openTab(activeTab);
    });


    // ğŸ“ ë°°ì†¡ì§€ ëª¨ë‹¬ ê¸°ëŠ¥ JavaScript (address.htmlì—ì„œ ê°€ì ¸ì˜´)
    const modal = document.getElementById('addressModal');
    const openBtn = document.getElementById('openModalBtn');
    const closeBtn = document.getElementsByClassName('close')[0];
    const form = $('#addressForm');

    // ëª¨ë‹¬ ì—´ê¸° (ì¶”ê°€ ëª¨ë“œ)
    openBtn.onclick = function() {
        $('#modalTitle').text('ìƒˆ ë°°ì†¡ì§€ ì¶”ê°€');
        $('#addId').val('');
        form[0].reset();
        modal.style.display = 'block';
    }

    // ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì • ëª¨ë“œ)
    $('.editBtn').on('click', function() {
        const data = $(this).data();

        $('#modalTitle').text('ë°°ì†¡ì§€ ìˆ˜ì • (ID: ' + data.addId + ')');
        $('#addId').val(data.addId);
        $('#addNameInput').val(data.addName);
        $('#addressFormInput').val(data.address);

        modal.style.display = 'block';
    });

    // ëª¨ë‹¬ ë‹«ê¸°
    closeBtn.onclick = function() { modal.style.display = 'none'; }
    window.onclick = function(event) {
        if (event.target == modal) { modal.style.display = 'none'; }
    }
</script>
</body>
</html>