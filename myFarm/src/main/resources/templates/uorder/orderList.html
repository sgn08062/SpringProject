<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문 내역</title>
    <link rel="stylesheet" href="../main/main.css">
    <link rel="stylesheet" href="../uorder/orderlist.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>📦 주문 내역 관리</h1>

<div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>
<div th:if="${errorMessage}" class="message error" th:text="${errorMessage}"></div>

<div id="orderListTab" class="tab-content active">
    <h2 th:text="${userName} != null ? ${userName} + '님의 주문 내역' : '주문 내역'">주문 내역</h2>

    <form id="searchForm" th:action="@{/uorder/list}" method="get">
        <div class="date-search-container">
            <div class="date-tabs">
                <button type="button" class="date-tab active" data-period="365">최대(1년)</button>
                <button type="button" class="date-tab" data-period="30">1개월</button>
                <button type="button" class="date-tab" data-period="90">3개월</button>
                <button type="button" class="date-tab" data-period="180">6개월</button>
            </div>

            <div class="date-input-group">
                <label for="startDate"></label>
                <input type="date" id="startDate" name="startDate" th:value="${startDate}">

                <span>~</span>

                <label for="endDate"></label>
                <input type="date" id="endDate" name="endDate" th:value="${endDate}">
            </div>

            <input type="hidden" name="page" th:value="${pageVO != null ? pageVO.cri.pageNum : 1}">
            <input type="hidden" name="size" th:value="${pageVO != null ? pageVO.cri.amount : 10}">

            <div class="search-action-buttons">
                <button type="submit" class="search-button">조회하기</button>
                <button type="button" onclick="resetSearch()" class="reset-button">초기화</button>
            </div>
        </div>
    </form>


    <div th:if="${orderList != null and not #lists.isEmpty(orderList)}">
        <table>
            <thead>
            <tr>
                <th>주문 번호</th>
                <th>대표 상품</th>
                <th>총액</th>
                <th>배송지</th>
                <th>상태</th>
                <th>주문 일자</th>
                <th>상세보기</th> <th>주문 취소</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${orderList}">
                <td th:text="${order.orderId}">1</td>
                <td th:text="${order.representativeItemName}">상품명</td>
                <td th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + '원'">총액</td>
                <td th:text="${order.address}">배송 주소</td>
                <td th:text="${order.status}">상태</td>
                <td th:text="${order.orderDate != null ? #temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm:ss') : '날짜 없음'}">일자</td>

                <td>
                    <a href="#" class="detail-button" th:data-order-id="${order.orderId}">상세보기</a>
                </td>

                <td>
                    <button
                            class="cancel-button"
                            th:data-order-id="${order.orderId}"
                            th:disabled="${order.status == '배송 중' or order.status == '배송완료' or order.status == '주문 취소'}"
                            th:text="${order.status == '주문 취소' ? '취소 완료' : '주문 취소'}">
                        주문 취소
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div th:if="${orderList == null or #lists.isEmpty(orderList)}">
        <p>아직 주문 내역이 없습니다.</p>
    </div>

    <div class="pagination" th:if="${pageVO != null and pageVO.total > 0}">

        <span th:if="${pageVO.prev}">
            <a th:href="@{/uorder/list(
               page=1,
               size=${pageVO.cri.amount},
               startDate=${startDate},
               endDate=${endDate})}"
               class="page-link">&lt;&lt;</a>
        </span>

        <span th:if="${pageVO.prev}">
            <a th:href="@{/uorder/list(
               page=${pageVO.startPage - 1},
               size=${pageVO.cri.amount},
               startDate=${startDate},
               endDate=${endDate})}"
               class="page-link">&lt;</a>
        </span>

        <span th:each="i : ${#numbers.sequence(pageVO.startPage, pageVO.endPage)}">
            <a th:if="${i != pageVO.cri.pageNum}"
               th:href="@{/uorder/list(
                  page=${i},
                  size=${pageVO.cri.amount},
                  startDate=${startDate},
                  endDate=${endDate})}"
               th:text="${i}"
               class="page-link">1</a>
            <strong th:if="${i == pageVO.cri.pageNum}" th:text="${i}">1</strong>
        </span>

        <span th:if="${pageVO.next}">
            <a th:href="@{/uorder/list(
               page=${pageVO.endPage + 1},
               size=${pageVO.cri.amount},
               startDate=${startDate},
               endDate=${endDate})}"
               class="page-link">&gt;</a>
        </span>

        <span th:if="${pageVO.next}">
            <a th:href="@{/uorder/list(
               page=${pageVO.totalPages},
               size=${pageVO.cri.amount},
               startDate=${startDate},
               endDate=${endDate})}"
               class="page-link">&gt;&gt;</a>
        </span>
    </div>
</div>

<div id="orderDetailModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>주문 상세 정보</h2>
        <div id="modalBodyContent">
            <p>상세 내용을 불러오는 중입니다...</p>
        </div>
    </div>
</div>


<form id="cancelForm" method="post" action="" style="display:none;"></form>

<script src="../uorder/orderlist.js"></script>

</body>
</html>